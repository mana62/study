# Laravel サービスクラス
→ アプリの処理（ロジック）を整理してまとめるためのクラス
    - ビジネスロジックを書く場所
    - コントローラーを肥大化させないためにつくられる
    - laravelではサービスコンテナの機能で簡単に依存性注入ができる

---

## ビジネスロジックとは
→ アプリの「仕事のルール」や「やりたいこと」の処理
    - ユーザー登録のルール
    - 注文の計算
    - ポイント付与の条件
    - メール送信のタイミング

| 種類                   | 説明                               | 例                                  |
| -------------------- | -------------------------------- | ---------------------------------- |
| **技術的な処理（インフラロジック）** | データを保存したり、画面を表示したりなど、「技術的に必要なこと」 | ルーティング・DB接続・ビューの表示など               |
| **ビジネスロジック（業務ロジック）** | アプリが実際に「やるべきこと（目的）」              | 商品を購入する、メールを送る、ポイントを計算する、在庫を減らす など |


---

## サービスクラスがやること
- 計算・判定・複雑な処理
- 複数のModelを組み合わせる
- トランザクション管理
- メール送信などの副作用


---

## なぜ分けるのか
- Controllerがゴチャゴチャしない
- テストしやすくなる
- 再利用しやすくなる
- 責務が分かれて保守しやすい

---

## サービスクラスはどこに配置するのか
→ 一般的には app/Services/ にまとめる

```bash
app/
└── Services/
    └── UserService.php
```
---

## 基本の書き方
```bash
# UserService.php
namespace App\Services;

use App\Models\User;
use Illuminate\Support\Facades\Mail;

class UserService
{
    public function register(array $data)
    {
        $user = User::create($data);

        Mail::to($user->email)->send(new \App\Mail\WelcomeMail($user));

        return $user;
    }
}
```

```bash
# コントローラで呼び出す場合
public function store(Request $request, UserService $userService)
{
    $user = $userService->register($request->all());
    return redirect()->route('users.show', $user);
}
```

---

## 依存注入（DI）とは
→ コントローラで使いたいクラス（サービスなど）を自動で渡してもらう仕組み

```bash
# 例
use App\Services\UserService;

class UserController extends Controller
{
    protected $userService;

    public function __construct(UserService $userService)
    {
        $this->userService = $userService;
    }

    public function index()
    {
        $users = $this->userService->getAllUsers();
        return view('users.index', compact('users'));
    }
}

# __construct() の引数に UserService を書く
# Laravelが自動で UserService を作って $userService に渡してくれる
```


---

## DIが使える場所
- コントローラのコンストラクタ
- メソッドの引数（アクションインジェクション）
- サービスクラスの中でも使える

---

## コントローラとサービスクラスの違い

| 項目           | コントローラ                             | サービスクラス                         |
|----------------|------------------------------------------|----------------------------------------|
| **役割**       | リクエストを受けてレスポンスを返す       | 処理の中身（ロジック）を実行する       |
| **書き方**     | `extends Controller` が必要              | 通常のクラス定義でOK                   |
| **メソッド名** | `index`, `store`, `update` などルートに対応 | 処理に応じた自由な名前でOK             |
| **DI（依存注入）** | `$userService` を受け取る側           | 他のサービスやモデルを使う側           |


---

## イメージ
- コントローラ： 「何をするか」指示を出す人（交通整理）
- サービス： 実際に仕事をこなす人（業務担当）
- モデル： データ（商品・注文など）そのもの


---

## 参考
- [Laravel サービスクラスを活用したメソッドの実装方法](https://zenn.dev/imkei/articles/5b1f7948a78f6f)
- [Laravel でサービス(Service)クラスの作り方](https://qiita.com/ntm718/items/14751e6d52b4bebde810)
- [Laravel 学習記録 #011 サービスクラスを学ぶ](https://note.com/mura_lara/n/n23786849b43c)
- [「ビジネスロジック」とは何か、どう実装するのか](https://qiita.com/os1ma/items/25725edfe3c2af93d735)
- [ビジネスロジックとは](https://wa3.i-3-i.info/word13666.html)
- [ビジネスロジック層って名前、広すぎない？— ビジネスロジックという名状しがたい何かについて](https://blog.grp.mk-dt.com/2024/12/19/%E3%83%93%E3%82%B8%E3%83%8D%E3%82%B9%E3%83%AD%E3%82%B8%E3%83%83%E3%82%AF%E5%B1%A4%E3%81%A3%E3%81%A6%E5%90%8D%E5%89%8D%E3%80%81%E5%BA%83%E3%81%99%E3%81%8E%E3%81%AA%E3%81%84%EF%BC%9F-%E3%83%93/)