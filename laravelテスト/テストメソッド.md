# Laravel 機能テストメソッド一覧

---

## 値そのものを検証するテスト（Unitでよく使う）

| メソッド                                           | 説明                           | 引数の構成（第1引数 / 第2引数） |
| -------------------------------------------------- | ------------------------------ | ------------------------------- |
| `assertTrue($値)`                                  | 値が `true` か確認             | 条件式 / なし                   |
| `assertFalse($値)`                                 | 値が `false` か確認            | 条件式 / なし                   |
| `assertEquals($期待値, $実際の値)`                 | 等しいか確認（==）             | 期待値 / 実際の値               |
| `assertNotEquals($期待値, $実際の値)`              | 等しくないか確認               | 期待値 / 実際の値               |
| `assertSame($期待値, $実際の値)`                   | 厳密に一致（===）              | 期待値 / 実際の値               |
| `assertNotSame($期待値, $実際の値)`                | 厳密に異なる（!==）            | 期待値 / 実際の値               |
| `assertLessThan($値1, $値2)`                       | 値1より値2が小さいか           | 基準値 / 比較対象               |
| `assertGreaterThan($値1, $値2)`                    | 値1より値2が大きいか           | 基準値 / 比較対象               |
| `assertCount($数, $配列)`                          | 要素数が一致するか             | 期待する数 / 配列               |
| `assertEmpty($値)`                                 | 空かどうか確認                 | 対象の値 / なし                 |
| `assertNotEmpty($値)`                              | 空でないことを確認             | 対象の値 / なし                 |
| `assertNull($値)`                                  | nullかどうか確認               | 対象の値 / なし                 |
| `assertNotNull($値)`                               | nullでないことを確認           | 対象の値 / なし                 |
| `assertInstanceOf($クラス名, $オブジェクト)`       | 指定クラスのインスタンスか確認 | クラス名 / インスタンス         |
| `assertStringStartsWith($開始文字列, $対象文字列)` | 文字列の先頭が一致するか       | 開始文字列 / 対象文字列         |
| `assertStringEndsWith($終了文字列, $対象文字列)`   | 文字列の末尾が一致するか       | 終了文字列 / 対象文字列         |
| `assertContains($値, $配列)`                       | 配列に値が含まれているか       | 値 / 配列                       |
| `assertNotContains($値, $配列)`                    | 配列に値が含まれていないか     | 値 / 配列                       |
| `assertStringContainsString($部分, $文字列)`       | 部分文字列が含まれているか     | 部分文字列 / 対象文字列         |

---

## HTTPレスポンス・ビュー・セッション関連（Feature Test）

| メソッド                           | 説明                             | 第1引数 / 第2引数                  |
| ---------------------------------- | -------------------------------- | ---------------------------------- |
| `assertStatus($コード)`            | ステータスコードが一致するか     | HTTPコード（例：200） / なし       |
| `assertRedirect($パス)`            | リダイレクト先が正しいか         | パス（例：/home） / なし           |
| `assertRedirectToRoute($ルート名)` | 指定ルートにリダイレクトされたか | ルート名（例：dashboard） / なし   |
| `assertViewIs($ビュー名)`          | 使用されたビュー名が一致するか   | ビュー名（例：users.index） / なし |
| `assertViewHas($変数名)`           | ビューに変数が渡されているか     | 変数名 / なし or 値                |
| `assertViewHasAll($変数名配列)`    | 複数の変数が渡されているか       | 配列（例：['user','post']） / なし |
| `assertSessionHas($キー, $値)`     | セッションにキーと値があるか     | キー / 値                          |
| `assertSessionMissing($キー)`      | セッションにキーがないか         | キー / なし                        |
| `assertSee($文字列)`               | HTMLに文字列が含まれているか     | 検索文字列 / なし                  |
| `assertDontSee($文字列)`           | HTMLに文字列が含まれていないか   | 非表示であるべき文字列 / なし      |
| `assertNoContent()`                | ステータスコードが204か確認      | なし                               |
| `assertNotFound()`                 | ステータスコードが404か確認      | なし                               |
| `assertSuccessful()`               | 成功レスポンス（2xx）か確認      | なし                               |
| `assertUnauthorized()`             | ステータスコードが401か確認      | なし                               |

---

## JSONレスポンス関連

| メソッド                         | 説明                           | 第1引数 / 第2引数 |
| -------------------------------- | ------------------------------ | ----------------- |
| `assertJson([...])`              | JSONにキーと値が含まれているか | 配列 / なし       |
| `assertExactJson([...])`         | 完全一致するJSONか             | 配列 / なし       |
| `assertJsonFragment([...])`      | 一部一致するJSONか             | 配列 / なし       |
| `assertJsonMissing([...])`       | JSONに含まれていないか         | 配列 / なし       |
| `assertHeader($ヘッダー名, $値)` | レスポンスヘッダーが一致するか | ヘッダー名 / 値   |
|`assertJsonStructure([...])`| JSONのキーがあるか |

---

```js
// 値を確認
$response->assertJson(['name' => '商品A']);

// 部分一致
$response->assertJsonFragment(['name' => '商品A']);

// キーの存在確認
$response->assertJsonStructure(['name', 'price']);

// 完全一致
$response->assertExactJson([...]);
```

## データベース関連

| メソッド                                    | 説明                               | 第1引数 / 第2引数           |
| ------------------------------------------- | ---------------------------------- | --------------------------- |
| `assertDatabaseHas('テーブル', [条件])`     | DBにデータが存在するか             | テーブル名 / 検索条件の配列 |
| `assertDatabaseMissing('テーブル', [条件])` | DBにデータが存在しないか           | テーブル名 / 検索条件の配列 |
| `assertDatabaseCount('テーブル', 件数)`     | テーブルのレコード件数が一致するか | テーブル名 / 件数           |
| `assertModelExists($モデル)`                | モデルがDBに存在するか             | モデルインスタンス / なし   |
| `assertModelMissing($モデル)`               | モデルがDBに存在しないか           | モデルインスタンス / なし   |

---

## 認証関連

| メソッド                           | 説明                                 | 第1引数 / 第2引数           |
| ---------------------------------- | ------------------------------------ | --------------------------- |
| `assertAuthenticated()`            | 認証済みか確認                       | なし                        |
| `assertAuthenticatedAs($ユーザー)` | 特定のユーザーとして認証されているか | ユーザーインスタンス / なし |
| `assertGuest()`                    | ゲスト（未認証）状態か確認           | なし                        |

---

## ファイル・ストレージ関連

| メソッド                              | 説明                         | 第1引数 / 第2引数   |
| ------------------------------------- | ---------------------------- | ------------------- |
| `Storage::disk(...)->assertExists()`  | ファイルが存在するか         | ファイルパス / なし |
| `Storage::disk(...)->assertMissing()` | ファイルが存在しないか       | ファイルパス / なし |
| `assertDownload($ファイル名)`         | ダウンロードレスポンスか確認 | ファイル名 / なし   |

---

## メール関連

| メソッド             | 説明                     | 第1引数 / 第2引数                       |
| -------------------- | ------------------------ | --------------------------------------- |
| `Mail::assertSent()` | メールが送信されたか確認 | メールクラス / コールバック関数（任意） |

---


## 例外・スキップ系

| メソッド                              | 説明                       | 第1引数 / 第2引数       |
| ------------------------------------- | -------------------------- | ----------------------- |
| `expectException($例外クラス)`        | 指定の例外が発生するか     | 例外クラス名 / なし     |
| `expectExceptionMessage($メッセージ)` | 例外メッセージが一致するか | メッセージ文字列 / なし |
| `markTestIncomplete()`                | テ                         |


withServerVariables:任意のIPアドレスからアクセスしたように見せかけることができる
REMOTE_ADDR:IP制限ミドルウェアの挙動をテストできる


## AJAX
- `postJson()` : JSONを送るPOSTリクエストをテストで送るためのメソッド
- `putJson()` : JSONを送るPUTリクエストをテストで送るためのメソッド
- `getJson()` : JSONレスポンスを期待するGETリクエストを送るメソッド
- `patchJson()` : JSONを送るPATCHリクエストをテストで送るためのメソッド
- `X-Requested-With: XMLHttpRequest` : AJAXリクエストとして扱われるようにするためのヘッダー


## ステータス
```php
// 200 OK
$response->assertOk();
$response->assertStatus(200);

// 201 Created（新規作成）
$response->assertCreated();
$response->assertStatus(201);

// 204 No Content（削除成功）
$response->assertNoContent();
$response->assertStatus(204);

// 404 Not Found
$response->assertNotFound();
$response->assertStatus(404);
```