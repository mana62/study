# 正規表現

### 使用場面
- 特定の文字列を探す
- 形式が正しいか確認する（バリデーション）
- 文字列を置換する
- 特定のパターンで文字列を分割する

### 基本の書き方
- スラッシュ / で囲んだ部分が正規表現の「パターン」になる
```js
const regex = /パターン/;
// /.../は開始と終了を表す
```

---

## ①作成方法
- 正規表現は2通りの方法で定義ができる

### リテラル記法
```js
const re = /ab+c/;

// 読み込み時にコンパイルされ、パフォーマンスが良い
```

### コンストラクタ記法
```js
const re = new RegExp("ab+c");

// 実行時にパターンを生成できて、ユーザー入力など動的に使える
```

---

## ②基本パターン
- 単純に文字列を検索する例：`/abc/`
- `ab*c → a`に続きbが0回以上、その後cにマッチ

```js
/ab*c/.test("abbbc");  // true
```
---


## ③特殊文字

| 特殊文字 | 意味・説明                                                                          |
| -------- | ----------------------------------------------------------------------------------- |
| `.`      | 任意の1文字と一致（※改行を除く）。例：`a.b` → "acb", "a1b" などに一致               |
| `*`      | 直前の文字が「0回以上」繰り返される。例：`a*` → "", "a", "aa", "aaa"...             |
| `+`      | 直前の文字が「1回以上」繰り返される。例：`a+` → "a", "aa", "aaa"...                 |
| `?`      | 直前の文字が「0回または1回」存在する場合に一致。例：`a?` → "", "a"                  |
| `{n}`    | 直前の文字が「n回」繰り返される場合に一致。例：`a{3}` → "aaa"                       |
| `{n,}`   | 「n回以上」繰り返される場合に一致。例：`a{2,}` → "aa", "aaa", …                     |
| `{n,m}`  | 「n回以上m回以下」繰り返される場合に一致。例：`a{1,3}` → "a", "aa", "aaa"           |
| `^`      | 行の先頭にマッチ。例：`^Hello` → "Hello world" には一致、"say Hello" には一致しない |
| `$`      | 行の末尾にマッチ。例：`world$` → "Hello world" に一致                               |
| `\w`     | 英字（a–z, A–Z）・数字・アンダースコアに一致。例：`\w+` → "word123"                 |
| `\d`     | 数字1文字（0–9）に一致。例：`\d+` → "2025", "9"                                     |
| `\s`     | 空白文字（スペース、タブ、改行など）に一致。例：`\s+` → "   ", "\n"など             |
| `[abc]`  | 中に書かれた任意の文字と一致。例：`[ab]` → "a" や "b" に一致                        |
| `[^abc]` | 中の文字以外に一致。例：`[^ab]` → "c", "d" など（否定文字セット）                   |
| `(abc)`  | グループ化。ひとまとまりとして扱える。例：`(ab)+` → "ab", "abab", …                 |
| `        | `                                                                                   | 選択肢（OR）。例：`cat | dog` → "cat" または "dog" に一致 |
| `\`      | エスケープ文字。正規表現の記号を文字として扱いたいとき。例：`\.` → "."              |


<br>

- `*`や`.`を文字として扱いたい場合、`\`でエスケープする

```js
/a\*b/.test("a*b");     // true
/\/example\//.test("/example/");  // true
```

---

## ④文字の集合を表現できる文字クラス
- 特定の文字・範囲をまとめて指定できる

### 文字クラス

| パターン       | 意味・説明                                       | 例にマッチする文字列                |
| -------------- | ------------------------------------------------ | ----------------------------------- |
| `[abc]`        | `a`, `b`, `c` のいずれか1文字に一致              | `"a"`, `"b"`, `"c"`                 |
| `[a-c]`        | `a`～`c` の範囲にある1文字に一致（同じ意味）     | `"a"`, `"b"`, `"c"`                 |
| `[^abc]`       | `a`, `b`, `c` 以外の文字に一致（否定文字セット） | `"d"`, `"x"`（ただし `"a"` は除外） |
| `[0-9]`        | 0〜9の数字に一致                                 | `"5"`, `"0"`, `"9"`                 |
| `[a-zA-Z0-9_]` | 英字・数字・アンダースコアのいずれかに一致       | `"A"`, `"z"`, `"7"`, `"_"`          |

---

### ショートカット

| パターン | 意味・説明                                      | 例にマッチする文字列       |
| -------- | ----------------------------------------------- | -------------------------- |
| `\d`     | 数字（`[0-9]`）に一致                           | `"3"`, `"9"`, `"2025"`     |
| `\D`     | 数字以外の任意の1文字に一致（数字を除く）       | `"a"`, `"!"`, `" "`        |
| `\w`     | 英数字 + アンダースコア（`[a-zA-Z0-9_]`）に一致 | `"x"`, `"5"`, `"Z"`, `"_"` |
| `\W`     | `\w` 以外の1文字に一致（記号や空白など）        | `"@"`, `" "`, `"%"`        |
| `\s`     | 空白文字（スペース、タブ、改行など）に一致      | `" "`, `"\n"`, `"\t"`      |
| `\S`     | 空白文字以外に一致                              | `"a"`, `"1"`, `"@"`        |


```js
/\d+/.test("123");  // true
/[^a-z]/.test("1"); // true
```

---

## ⑤アサーション
- 位置だけを指定する特殊なパターン

| パターン       | 説明・用途                                            | 例にマッチする文字列               |
| -------------- | ----------------------------------------------------- | ---------------------------------- |
| `.`            | 改行以外の任意の1文字                                 | `"a"`, `"1"`, `"@"`                |
| `(...)`        | グループ化（複数の文字列をひとまとまりに）            | `"abc"` → `(abc)+` → "abcabc"      |
| `(?:...)`      | 非キャプチャグループ（グループ化するが記録しない）    | `"(?:abc)+"` → "abcabc"            |
| `(?=...)`      | 先読み（直後が一致する場合のみ）                      | `"foo(?=bar)"` → "foobar" → "foo"  |
| `(?!...)`      | 否定先読み（直後が一致しない場合のみ）                | `"foo(?!bar)"` → "foobaz" → "foo"  |
| `(?<=...)`     | 後読み（直前が一致する場合のみ）※一部ブラウザのみ対応 | `"(?<=foo)bar"` → "foobar" → "bar" |
| `(?<!...)`     | 否定後読み（直前が一致しない場合のみ）                | `"(?<!foo)bar"` → "bazbar" → "bar" |
| `              | `                                                     | OR（いずれかに一致）               | `"cat | dog"` → "cat", "dog" |
| `\\`           | エスケープ（特殊記号を文字として扱う）                | `"\\."` → "."                      |
| `[a-zA-Z]`     | 英字（小文字〜大文字）                                | `"a"`, `"Z"`                       |
| `[0-9]`        | 数字（0〜9）                                          | `"3"`, `"7"`                       |
| `[a-zA-Z0-9_]` | 英数字＋アンダースコア                                | `"x"`, `"9"`, `"_"`                |
| `[^...]`       | 否定（指定以外の文字に一致）                          | `"[^abc]"` → "d", "x"              |

```js
/\w+$/g.test("hello");    // true
/\bfox\b/.test("A fox."); // true
/foo(?= bar)/.test("foo bar"); // true
```

例：
| パターン                  | 用途・説明                     | 例にマッチする文字列                  |
| ------------------------- | ------------------------------ | ------------------------------------- |
| `^\d{3}-\d{4}$`           | 郵便番号（000-0000形式）       | "123-4567"                            |
| `^\d{10,11}$`             | 電話番号（10〜11桁の数字）     | "09012345678"                         |
| `^[a-zA-Z0-9._%+-]+@...$` | メールアドレス形式             | "test@example.com"                    |
| `\b\w+\b`                 | 単語抽出（境界付き）           | "hello", "world"                      |
| `<[^>]+>`                 | HTMLタグ抽出                   | "<div>", "<span>"                     |
| `(?<=@)[^ ]+`             | メールのドメイン抽出（後読み） | "example.com" from "user@example.com" |

---

## ⑥グループと後方参照
- 丸括弧()で部分をキャプチャし、繰り返しや参照が可能
**(x) → グループキャプチャ**
(**?:x) → 非キャプチャグループ**
**(?<name>x) → 名前付きグループ**
**\1, \k<name> → 前にキャプチャした内容を再利用**

```js
/(\d+)-(\d+)/.exec("2025-07")[1]; // "2025"
/\b(\w+)\s+\1\b/.test("foo foo"); // true
```

---

## ⑦数量子（繰り返し）
- どれだけ繰り返すかを指定
### 正規表現の繰り返し指定（数量子）

| パターン | 意味                             | 具体例                                    | マッチする文字列例                 |
| -------- | -------------------------------- | ----------------------------------------- | ---------------------------------- |
| `a*`     | `a` が0回以上繰り返される        | `/a*/`                                    | "", "a", "aa", "aaa"               |
| `a+`     | `a` が1回以上繰り返される        | `/a+/`                                    | "a", "aa", "aaa"                   |
| `a?`     | `a` が0回または1回だけ現れる     | `/a?/`                                    | "", "a"                            |
| `a{3}`   | `a` がちょうど3回現れる          | `/a{3}/`                                  | "aaa"                              |
| `a{2,}`  | `a` が2回以上繰り返される        | `/a{2,}/`                                 | "aa", "aaa", "aaaa"                |
| `a{2,4}` | `a` が2回以上4回以下繰り返される | `/a{2,4}/`                                | "aa", "aaa", "aaaa"                |
| `ha?`    | `h` の後に `a` が0回または1回    | `/ha?/`                                   | "h", "ha"                          |
| `\d+`    | 数字が1回以上連続する            | `/\d+/`                                   | "3", "42", "2025"                  |
| `w{3}`   | `w` が3回ちょうど繰り返される    | `/w{3}/`                                  | "www"                              |
| `go+`    | `g` のあとに `o` が1回以上       | `/go+/`                                   | "go", "goo", "goooo"               |
| `go*`    | `g` のあとに `o` が0回以上       | `/go*/`                                   | "g", "go", "goooo"                 |
| `a+?`    | 貪欲マッチではなく最小の一致     | `"aaaaa".match(/a+?/g)` → ["a", "a", ...] | "a" をできるだけ細かく分割して取得 |


```js
/a{2,4}/.test("aaa");  // true
/<.*?>/.test("<div><p>"); // 非貪欲で "<div>" にマッチ
```

---

## ⑧正規表現のオプション
| フラグ記号 | 機能                   | 説明                                                     | よく使うケース例                         |
| ---------- | ---------------------- | -------------------------------------------------------- | ---------------------------------------- |
| `g`        | グローバル検索         | 一致するすべての箇所を検索する（なければ最初の一致だけ） | 文字列全体からパターンを抽出したいとき   |
| `i`        | 大文字小文字の無視     | 大文字と小文字を区別せずに一致判定                       | `"A"`と`"a"`を同じ扱いにしたいとき       |
| `m`        | 複数行モード           | `^`や`$`が各行の先頭／末尾にマッチするように             | 複数行テキストに対して行単位で判定したい |
| `s`        | ドットオール（dotAll） | `.`（ドット）が改行文字 `\n` にも一致する                | HTMLやテンプレート内の改行含むデータ     |
| `u`        | Unicode モード         | Unicode文字（絵文字・記号など）の正しい認識／一致        | 絵文字・非ASCII文字が絡む検索や抽出      |
| `y`        | スティッキー（sticky） | 現在の位置からのみマッチを試みる（先頭から順に）         | 位置固定の連続抽出やパーサ実装など       |


## ⑨主なメソッド使い分け
| メソッド                     | 使用元   | 機能・説明                                                                | 戻り値の型                              |
| ---------------------------- | -------- | ------------------------------------------------------------------------- | --------------------------------------- |
| `test()`                     | 正規表現 | 文字列がパターンに一致するか判定                                          | `true` または `false`（boolean）        |
| `exec()`                     | 正規表現 | 一致した詳細情報（文字列・インデックス・グループ）を取得                  | `RegExpMatchArray`（配列）または `null` |
| `match()`                    | 文字列   | 正規表現に一致する部分を抽出                                              | 配列（マッチした文字列群）または `null` |
| `matchAll()`                 | 文字列   | 正規表現に一致するすべての詳細情報をイテレータで取得（`g`フラグ必須）     | `RegExpStringIterator`（イテレータ）    |
| `search()`                   | 文字列   | 正規表現に一致した最初の位置インデックスを返す                            | `number`（一致位置）または `-1`         |
| `replace()` / `replaceAll()` | 文字列   | 一致する部分を、指定の文字列または関数の戻り値で置き換える（`g`で全置換） | 新しい文字列（`string`）                |
| `split()`                    | 文字列   | 正規表現に一致した部分で文字列を分割                                      | `string[]`（文字列配列）                |
| `flags`                      | 正規表現 | フラグ（`gi`, `gm`など）を文字列で取得                                    | `string`（使用中フラグ）                |
| `source`                     | 正規表現 | 正規表現の元パターンを文字列で取得                                        | `string`                                |


## 正規表現パターン
### 特定の文字列を探す

```jsx
const regex = /hello/;
```

### 任意の1文字を表す「.」

```js
const regex = /h.llo/; // 「h」と「llo」の間に何か1文字がある
console.log("hello".match(regex)); // ["hello"]
console.log("hallo".match(regex));
// ["hallo"]
```

---

### 文字クラス「[]」

- `[]` の中に指定した文字のいずれか1文字に一致する

```jsx
const regex = /h[eai]llo/; // 「e」「a」「i」のいずれか1文字に一致
console.log("hello".match(regex)); // ["hello"]
console.log("hallo".match(regex)); // ["hallo"]
```

---

### 繰り返しを表す「+」「*」「?」

- `+`：1回以上の繰り返し
- `*`：0回以上の繰り返し
- `?`：0回または1回

```js
const regex1 = /go+/; // 「g」に続く「o」が1回以上
console.log("go".match(regex1));    // ["go"]
console.log("goooo".match(regex1)); // ["goooo"]

const regex2 = /go*/; // 「g」に続く「o」が0回以上
console.log("g".match(regex2));     // ["g"]
console.log("goooo".match(regex2)); // ["goooo"]
```

---

### 先頭・末尾を表す「^」「$」

- `^`：文字列の**先頭**に一致
- `$`：文字列の**末尾**に一致

```js
const regex1 = /^hello/; // 先頭が「hello」で始まる
console.log("hello world".match(regex1)); // ["hello"]

const regex2 = /world$/; // 末尾が「world」で終わる
console.log("hello world".match(regex2)); // ["world"]

```

---

### ORを表す「|」

```js
const regex = /apple|banana/;
console.log("I like apple".match(regex));  // ["apple"]
console.log("I like banana".match(regex)); // ["banana"]
```

---

### エスケープ文字「\」

- `.` や `+` などの特殊な記号をそのままの文字として扱いたい場合、**「\」でエスケープする**

```jsx
const regex = /a\.b/; // 「a.b」という文字列に一致
console.log("a.b".match(regex)); // ["a.b"]
console.log("acb".match(regex)); // null

```

---
### メールアドレスのバリデーション

```js
const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
const email = "example@example.com";
console.log(emailRegex.test(email)); // true
```

---

### 数字だけを抽出する

```js
const str = "電話番号は090-1234-5678です";
const regex = /\d+/g;
// 「\d+」は1回以上の数字「g」はすべてを対象にする
console.log(str.match(regex)); // ["090", "1234", "5678"]
```

---

### バリデーション
```js
document.addEventListener("DOMContentLoaded", function () {
  const form = document.querySelector("form");

  form.addEventListener("submit", function (event) {
    event.preventDefault();

    const name = document.getElementById("name").value.trim();
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value.trim();
    const number = document.getElementById("number").value.trim();
    const postNumber = document.getElementById("post_number").value.trim();
    const age = document.getElementById("age").value.trim();
    const date = document.getElementById("date").value.trim();

    let errors = [];

    // 文字数チェック
    if (name.length < 3 || name.length > 20) {
      errors.push("お名前は3文字以上20文字以下で入力してください");
    }

    // メールアドレスチェック
    const emailPattern = /^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/;
    if (!emailPattern.test(email)) {
      errors.push("有効なメールアドレスを入力してください");
    }

    // パスワードチェック
    const passwordPattern = /^[a-zA-Z0-9]+$/;
    if (!passwordPattern.test(password) || password.length < 6) {
      errors.push("パスワードは6文字以上の英数字のみで入力してください");
    }

    // 電話番号チェック
    const phonePattern = /^\d{10,11}$/;
    if (!phonePattern.test(number)) {
      errors.push("電話番号は10桁または11桁の数字で入力してください");
    }

    // 郵便番号チェック
    const postNumberPattern = /^\d{3}-\d{4}$/;
    if (!postNumberPattern.test(postNumber)) {
      errors.push("郵便番号は000-0000の形式で入力してください");
    }

    // 年齢チェック
    if (isNaN(age) || age < 0 || age > 120) {
      errors.push("年齢は0〜120の数値で入力してください");
    }

    // 日付チェック
    const datePattern = /^(\d{4})[\/\-\s](\d{1,2})[\/\-\s](\d{1,2})$/;
    if (!datePattern.test(date)) {
      errors.push("日付はYYYY/MM/DD、YYYY-MM-DD、またはYYYY MM DDの形式で入力してください");
    }

    // エラーがある場合は表示
    if (errors.length > 0) {
      alert(errors.join("\n"));
    } else {
      alert("送信が完了しました！");
      form.submit();
    }
  });
});
```