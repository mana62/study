# éåŒæœŸï¼ˆprimise / async/awaitï¼‰ã®å®šå‹åˆ†
ï¼éåŒæœŸã¯ å¾…ã¡æ™‚é–“ã§ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’æ­¢ã‚ãªã„ãŸã‚ã®ä»•çµ„ã¿
ï¼æ™‚é–“ãŒã‹ã‹ã‚‹å‡¦ç†ã‚’ã—ã¦ã‚‚ã‚¢ãƒ—ãƒªãŒå›ºã¾ã‚‰ãªã„
ï¼JavaScript ã§ã¯ async/await ã‚„ Promise ãŒéåŒæœŸã®åŸºæœ¬

## éåŒæœŸã‚’ä½¿ã†å ´é¢
ï¼æ™‚é–“ãŒã‹ã‹ã‚‹å‡¦ç†ã‚’ã™ã‚‹ã¨ãå…¨éƒ¨

ç‰¹ã«ï¼š
- API ã‚’å‘¼ã¶ã¨ãï¼ˆfetchï¼‰
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€ã¨ã
- ç”»åƒã‚„å‹•ç”»ã‚’èª­ã¿è¾¼ã‚€ã¨ã
- setTimeout / setInterval
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ“ä½œã‚’å¾…ã¤ã¨ã

## ğŸŸ¢Promise ã®åŸºæœ¬å½¢ï¼ˆå®šå‹ï¼‰
### â‘  Promise ã‚’è‡ªåˆ†ã§ä½œã‚‹ã¨ãã®å®šå‹
```js
const p = new Promise((resolve, reject) => {
  // éåŒæœŸå‡¦ç†
  if (æˆåŠŸ) {
    resolve(çµæœ);
  } else {
    reject(ã‚¨ãƒ©ãƒ¼);
  }
});
```
ã“ã‚Œã¯ã€ŒPromise ã‚’è‡ªåˆ†ã§ä½œã‚‹ã¨ãã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã€

### â‘¡ then / catch ã®å®šå‹
```js
p.then(result => {
  console.log("æˆåŠŸ:", result);
}).catch(error => {
  console.error("å¤±æ•—:", error);
});
```
Promise ã‚’ä½¿ã†ã¨ãã®åŸºæœ¬å½¢

### â‘¢ Promise + fetch ã®å®šå‹
```js
fetch(url)
  .then(res => res.json())
  .then(data => {
    console.log("æˆåŠŸ:", data);
  })
  .catch(err => {
    console.error("ã‚¨ãƒ©ãƒ¼:", err);
  });
```
fetch ã¯ Promise ã‚’è¿”ã™ã‹ã‚‰ã€ã“ã®å½¢ãŒã‚ˆãä½¿ã‚ã‚Œã‚‹

## ğŸŸ¢async/await ã®å®šå‹ï¼ˆPromise ã‚’ã‚‚ã£ã¨èª­ã¿ã‚„ã™ãã—ãŸå½¢ï¼‰
```js
async function run() {
  try {
    const res = await fetch(url);
    const data = await res.json();
    console.log("æˆåŠŸ:", data);
  } catch (err) {
    console.error("ã‚¨ãƒ©ãƒ¼:", err);
  }
}
```
å®Ÿéš›ã®ç¾å ´ã§ã¯ async/await ã®æ–¹ãŒåœ§å€’çš„ã«ä½¿ã‚ã‚Œã‚‹

## ğŸŸ¢Promise.all ã®å®šå‹ï¼ˆè¤‡æ•°ã®éåŒæœŸã‚’åŒæ™‚ã«å¾…ã¤ï¼‰
```js
Promise.all([fetch(url1), fetch(url2)])
  .then(([res1, res2]) => Promise.all([res1.json(), res2.json()]))
  .then(([data1, data2]) => {
    console.log(data1, data2);
  })
  .catch(err => console.error(err));
```

## ğŸŸ¢async/await ç‰ˆ Promise.all
```js
async function run() {
  try {
    const [res1, res2] = await Promise.all([
      fetch(url1),
      fetch(url2)
    ]);

    const [data1, data2] = await Promise.all([
      res1.json(),
      res2.json()
    ]);

    console.log(data1, data2);
  } catch (err) {
    console.error(err);
  }
}
```

## ğŸŸ¢ã¾ã¨ã‚ï¼šPromise ã®ã€Œå®šå‹åˆ†ã€
| ç”¨é€” | å®šå‹ |
|------|------|
| Promise ã‚’ä½œã‚‹ | `new Promise((resolve, reject) => {})` |
| then / catch | `p.then(...).catch(...)` |
| fetchï¼ˆPromiseç‰ˆï¼‰ | `fetch(url).then(res => res.json())` |
| async / await | `try { await ... } catch (e) {}` |
| Promise.all | `Promise.all([...])` |
| POSTï¼ˆasync/awaitï¼‰ | `await fetch(url, { method: "POST", headers: {...}, body: JSON.stringify(data) })` |


## ğŸŸ async/await ã®åŸºæœ¬å®šå‹ï¼ˆGETï¼‰
```js
// getã®å ´åˆ
async function run() {
  try {
    const res = await fetch(url);
    const data = await res.json();
    console.log("æˆåŠŸ:", data);
  } catch (err) {
    console.error("ã‚¨ãƒ©ãƒ¼:", err);
  }
}
```
ã“ã‚ŒãŒ async/await ã® æœ€ã‚‚åŸºæœ¬çš„ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

## ğŸŸ è¤‡æ•°ã® await ã‚’é †ç•ªã«å®Ÿè¡Œã™ã‚‹å®šå‹
```js
async function run() {
  try {
    const userRes = await fetch('/users');
    const users = await userRes.json();

    const postRes = await fetch(`/posts?userId=${users[0].id}`);
    const posts = await postRes.json();

    console.log(users, posts);
  } catch (err) {
    console.error(err);
  }
}
```
ã€Œ1ã¤ç›®ã®çµæœã‚’ä½¿ã£ã¦2ã¤ç›®ã‚’å‘¼ã¶ã€ã¿ãŸã„ãªã¨ãã®å®šç•ª

## ğŸŸ Promise.all ã‚’ async/await ã§ä½¿ã†å®šå‹ï¼ˆåŒæ™‚ã«å®Ÿè¡Œï¼‰
```js
async function run() {
  try {
    const [res1, res2] = await Promise.all([
      fetch(url1),
      fetch(url2)
    ]);

    const [data1, data2] = await Promise.all([
      res1.json(),
      res2.json()
    ]);

    console.log(data1, data2);
  } catch (err) {
    console.error(err);
  }
}
```
è¤‡æ•°ã®éåŒæœŸã‚’ åŒæ™‚ã«å¾…ã¤ã¨ãã®ãƒ†ãƒ³ãƒ—ãƒ¬

## ğŸŸ async é–¢æ•°ã®è¿”ã‚Šå€¤ã¯ Promise ã«ãªã‚‹å®šå‹
```js
async function getData() {
  return 123; // ã“ã‚Œã¯ Promise.resolve(123) ã¨åŒã˜
}

getData().then(v => console.log(v));
```
async é–¢æ•°ã¯ å¿…ãš Promise ã‚’è¿”ã™ã¨ã„ã†åŸºæœ¬

## ğŸŸ await ã§å¾…ã¤ã®ã¯ Promise ã ã‘
```js
const value = await Promise.resolve(10); // OK
const x = await 10; // 10 ãŒãã®ã¾ã¾è¿”ã‚‹ï¼ˆæš—é»™çš„ã« Promise.resolveï¼‰
```

## ğŸŸ ã¾ã¨ã‚ï¼šasync/await ã®å®šå‹åˆ†ï¼ˆGETï¼‰
| ç”¨é€” | å®šå‹ |
|------|------|
| åŸºæœ¬ã® try/catch | `try { await ... } catch {}` |
| fetch ã®åŸºæœ¬å½¢ | `const data = await (await fetch(url)).json()` |
| é †ç•ªã«å®Ÿè¡Œ | `const a = await A(); const b = await B(a);` |
| åŒæ™‚ã«å®Ÿè¡Œ | `await Promise.all([...])` |
| async ã®è¿”ã‚Šå€¤ | `return å€¤; // Promise ã«ãªã‚‹` |


## ğŸŸ£async/await å®šå‹ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆPOSTï¼‰
```js
async function postData(url, data) {
  try {
    const res = await fetch(url, {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(data)
    });

    const result = await res.json();
    return result;

  } catch (err) {
    console.error("ã‚¨ãƒ©ãƒ¼:", err);
  }
}
```

## ğŸŸ£ä½¿ã„æ–¹ï¼ˆå®šå‹ï¼‰
```js
const newUser = {
  name: "Taro",
  age: 25
};

const result = await postData(
  "https://jsonplaceholder.typicode.com/users",
  newUser
);

console.log(result);
```

## ğŸŸ£POST ã® async/await ã®æµã‚Œ
â‘ fetch ã« method: "POST" ã‚’æŒ‡å®š
â‘¡headers ã§ JSON ã‚’é€ã‚‹ã“ã¨ã‚’å®£è¨€
â‘¢body ã« JSON.stringify  ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’å…¥ã‚Œã‚‹
â‘£await ã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å¾…ã¤
â‘¤res.json() ã§ JSON ã«å¤‰æ›
â‘¥çµæœã‚’è¿”ã™

## ğŸŸ£POST + ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯ä»˜ãã®å®šå‹
```js
async function postData(url, data) {
  try {
    const res = await fetch(url, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });

    if (!res.ok) {
      throw new Error(`HTTPã‚¨ãƒ©ãƒ¼: ${res.status}`);
    }

    return await res.json();

  } catch (err) {
    console.error("POSTå¤±æ•—:", err);
  }
}
```

## ğŸŸ£ã¾ã¨ã‚ï¼šasync/await ã®ãƒ†ãƒ³ãƒ—ãƒ¬ï¼ˆPOSTï¼‰
```js
await fetch(url, {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify(data)
});
```
ã“ã‚Œã‚’è¦šãˆã¦ãŠã‘ã°ã€ã©ã‚“ãª POST API ã§ã‚‚æ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚‹
