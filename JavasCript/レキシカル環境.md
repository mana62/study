# レキシカル環境
→ 関数が "定義された場所" のスコープ（レキシカルスコープ）情報を保存したもの（関数内の変数など）
その関数が後で実行されても、その時の変数を覚えている

- JavaScriptはコードを読むとき、
「この変数、どこにある？」
「この関数、使っていい？」
を全部このレキシカル環境で管理している


⚫︎ダイナミックスコープ = 関数が実行された時を親とする
⚫︎レキシカルスコープ = 関数が実行された時ではなく、定義された、作られた時を親とする（JSはこっちを採用）

**outerEnv（外側参照）を持つのは「スコープを作るもの」だけ**

| 種類                     | outerEnvを持つ？ |
| ---------------------- | ------------ |
| 関数                     | ✅ 持つ         |
| ブロック（`{}` + let/const） | ✅ 持つ         |
| グローバル                  | ✅（一番外）       |
| オブジェクト                 | ❌ 持たない       |
| 配列                     | ❌ 持たない       |


## ブロックスコープに該当するもの
- ブロックスコープ（block scope）: プログラミングで「波括弧 {} の中だけで有効になる変数の有効範囲」のこと

```bash
スコープ（変数が生きている範囲）
├── グローバルスコープ（どこからでも見える）
└── ローカルスコープ
      ├── 関数スコープ（関数の中だけ）
      └── ブロックスコープ（{} の中だけ）
```

### 1. if 文

```js
if (true) {
    let a = 1;
}
console.log(a); // ❌ エラー
```

### 2. for 文

```js
for (let i = 0; i < 3; i++) {
    let x = i;
}
console.log(x); // ❌ エラー
```

### 3. while / do-while

```js
while (true) {
    const flag = true;
    break;
}
console.log(flag); // ❌ エラー
```

### 4. try / catch

```js
try {
    let msg = "hello";
} catch (e) {}
console.log(msg); // ❌ エラー
```

### 5. 単純な {} ブロック

```js
{
    const temp = 123;
}
console.log(temp); // ❌ エラー
```

| 種類                     | 例                 | スコープを作る？        |
|--------------------------|--------------------|--------------------------|
| 単純な `{}` ブロック     | `{ let x = 1; }`   | ✔ ブロックスコープ      |
| if / for / while の `{}` | `if (...) { ... }` | ✔ ブロックスコープ      |
| オブジェクト `{}`        | `{ name: "Mana" }` | ✖ スコープを作らない    |


---

### outerEnv を持つ
- 関数
- ブロック（let / const）
- グローバル

### outerEnv を持たない
- オブジェクト
- 配列
- クラスのフィールド自体

### 探索ルール
- 識別子 → レキシカル環境チェーン
- プロパティ → オブジェクト

### 「変数を見るか？プロパティを見るか？」
- 変数 → レキシカル環境（outerEnv）
- プロパティ → オブジェクト（this / .）

---

## スコープを作るものだけが outerEnv を持つもの
① グローバルスコープ
② 関数スコープ（function）： 呼ばれるたびに新しいレキシカル環境
③ ブロックスコープ（let / const）: {} + let / const （if / for / while / try / catch など）
④ catch の引数 : e は catch専用スコープ

```js
try {
  throw new Error();
} catch (e) {
  console.log(e);
}
```
⑤ class（本体）: class 自体はスコープを作る。ただし 使う場面はかなり限定的でメソッドの中は「関数スコープ」

---

# ❌ outerEnv を持たないもの
①オブジェクト
②配列
③var

---

# まとめ

| 作るもの                | スコープ作る？ | outerEnv |
| ------------------- | ------- | -------- |
| グローバル               | ✅       | null     |
| function            | ✅       | あり       |
| arrow function      | ✅       | あり       |
| if / for（let,const） | ✅       | あり       |
| try / catch         | ✅       | あり       |
| class               | ✅       | あり       |
| オブジェクト              | ❌       | なし       |
| 配列                  | ❌       | なし       |

---

# クロージャとは
「外側の変数を覚えたまま生き続ける関数」

---

# Environment（環境）とは？
JavaScriptエンジンが内部で作る、見えないデータ構造
- 変数
- 引数
- 関数宣言
- 外側への参照（outerEnv）
をまとめて管理するもの

Environment（レキシカル環境）= 変数を保管する見えない箱