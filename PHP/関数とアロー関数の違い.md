# 関数/アロー関数/無名関数の違い

```php
// 通常の関数（名前付き関数）
function greet($name) {
    return "Hello, " . $name . "さん";
}

echo greet("Taro"); // Hello, Taroさん

---

// 無名関数（クロージャ）
$greetClosure = function($name) {
    return "Hello, " . $name . "さん";
};

echo $greetClosure("Taro"); // Hello, Taroさん

---

// アロー関数（PHP 7.4〜）
$greetArrow = fn($name) => "Hello, " . $name . "さん";

echo $greetArrow("Taro"); // Hello, Taroさん

```


## 比較

| 項目                 | 通常の関数（function）         | 無名関数（closure）          | アロー関数（fn, PHP7.4〜）         |
| -------------------- | ------------------------------ | ---------------------------- | ---------------------------------- |
| **関数名**           | ✅ あり（名前をつけて定義）     | ❌ なし（変数に代入して使う） | ❌ なし（変数に代入して使う）       |
| **外部変数の利用**   | ❌ 直接は使えない（useが必要）  | ✅ `use ($var)` で渡す        | ✅ 自動で使える（use不要）          |
| **複数行の処理**     | ✅ OK（{}で自由に書ける）       | ✅ OK                         | ❌ NG（1行だけ）                    |
| **条件分岐・ループ** | ✅ OK（if, for など使える）     | ✅ OK                         | ❌ NG（ステートメント不可）         |
| **return文**         | ✅ 書ける                       | ✅ 書ける                     | ❌ 書けない（式の結果が返る）       |
| **use()の書き方**    | ❌ 基本不要                     | ✅ 必須（外部変数を使うとき） | ❌ 書くとエラーになる               |
| **コールバック登録** | ✅ 関数名を文字列で渡せる       | ✅ 変数に代入して渡す         | ✅ 変数に代入して渡す               |
| **再利用しやすさ**   | ◎ 高い（どこでも使える）       | △ 限定的（変数の範囲内）     | △ 限定的（変数の範囲内）           |
| **読みやすさ**       | ◯ わかりやすいが長くなる       | △ 少し長め                   | ◎ とても短く書ける                 |
| **向いている用途**   | 汎用的な処理・再利用したい関数 | 一時的な処理・コールバック   | 短い式・配列処理（map/filterなど） |

---

## `$this` の扱い方

| 関数の種類          | `$this` を使える？                     | 説明                                                                    |
| ------------------- | -------------------------------------- | ----------------------------------------------------------------------- |
| 通常の関数          | ❌ クラス外では使えない                 | クラスのメソッドとして定義すれば使えるが、関数単体では `$this` は未定義 |
| 無名関数（closure） | ✅ `use ($this)` で渡せば使える         | `$this` を明示的に `use` で渡す必要あり                                 |
| アロー関数（fn）    | ✅ 自動で `$this` を使える（PHP 7.4〜） | 定義されたスコープの `$this` をそのまま使える（use不要）                |

---

## staticとの違いと注意点

| 項目                           | 通常の関数 / 無名関数 / アロー関数       |
| ------------------------------ | ---------------------------------------- |
| **staticメソッド内の `$this`** | ❌ `$this` は使えない（staticでは未定義） |
| **static変数の利用**           | ✅ `static $count = 0;` など可能          |
| **クロージャ内での static**    | ✅ 使えるが `$this` は注意が必要          |

✔️ **staticメソッド**では `$this` が使えないため、クロージャやアロー関数で `$this` を使いたい場合は注意!!
✔️ アロー関数は `$this` を自動で引き継ぐため、**非staticメソッド内で使うのが基本**

---




## PHPの関数の種類と特徴

### 1. 関数 (Named Function)

* **主な用途**: 再利用可能な独立した処理
* **できないこと**:
    * プログラムの実行中に新しく関数を**作ることはできない**
    * **外側のスコープにある変数を直接使うことはできない**必ず引数として渡す必要がある

---

### 2. 無名関数 (Anonymous Function)

* **主な用途**: コールバック、一時的な処理、動的な生成
* **できないこと**:
    * `use`キーワードを使って**明示的に指定しない限り**、外側のスコープにある変数を使うことはできない

---

### 3. アロー関数 (Arrow Function)

* **主な用途**: 無名関数のより簡潔な記法
* **できないこと**:
    * **複数の処理を記述することはできない** 複数の変数の値を変更したり、複数の行でロジックを組むことは不可能