# Laravelコンポーネント
- コンポーネントは **「再利用できるUI部品」** を作る仕組み
- 1つの部品を何度も使えるようにして、**保守性・再利用性・責任分離** を高める

---

## コンポーネントの書き方

| 技術                      | コンポーネントの書き方           | 備考                                   |
| ------------------------- | -------------------------------- | -------------------------------------- |
| **React**                 | `<MyComponent prop="value" />`   | JSX構文でpropsを渡す                   |
| **Vue**                   | `<my-component :prop="value" />` | SFC（Single File Component）で使える   |
| **Web Components (純JS)** | `<my-element></my-element>`      | `customElements.define()` で定義       |
| **Blade (Laravel)**       | `<x-my-component />`             | `resources/views/components` に定義    |
| **HTMLのみ**              | ❌                                | コンポーネント機能はなし               |
| **JavaScriptのみ**        | （関数やクラスで再現）          | 関数でUIを生成するなどの工夫が必要     |

---

## Bladeコンポーネントとは
- Bladeコンポーネントは「**HTMLの中に小さなテンプレート部品を作る**」機能
- 共通パーツ（例：フォーム入力欄、ボタン、カードレイアウトなど）をまとめておくことで、同じデザインや処理を毎回書く必要がなくなる

---

## propsとは？
- コンポーネントに**外から値を渡すための引数**のこと
- ReactやVueの`props`と同じ考え方

#### 例：propsの定義

```php
@props(['entity', 'name', 'middle' => null, 'placeholder' => '', 'session_key' => null])
```

| 引数名           | 説明                                 | デフォルト値       |
| ------------- | ---------------------------------- | ------------ |
| `entity`      | 主となるエンティティ名（例：`'school_discount'`） | なし           |
| `name`        | 入力要素の名前（例：`'discount_rate'`）       | なし           |
| `middle`      | 配列の途中キー（グループ化用）                    | `null`       |
| `placeholder` | プレースホルダーテキスト                       | 空文字          |
| `session_key` | エラーや古い入力値を識別するためのキー                | `null`（自動生成） |


---

## PHPブロック（@php）
- Bladeの中でPHPを直接書くときに使う

```bash
@php
    $input_name = $entity . ($middle !== null ? "[$middle]" : '') . "[$name]";
    $session_key = $session_key ?? $entity . ($middle !== null ? ".$middle" : '') . ".$name";
@endphp
```

#### 処理の意味
**$input_name**
→ HTMLのname属性を組み立てる <br>
- 例：school_discount[special_discount][discount_rate]

**$session_key**
→ バリデーションやoldヘルパーで使うキー名を作る <br>
- 例：school_discount.special_discount.discount_rate

---

## `<input>` 要素部分

```bash
<input type="number"
    class="form-control{{ $errors->has($session_key) ? ' is-invalid' : '' }}"
    name="{{ $input_name }}"
    placeholder="{{ $placeholder }}"
    value="{{ old($session_key) }}"
    min="0"
    @if ($attributes->has('id')) id="{{ $attributes->get('id') }}" @endif
    {{ $attributes->except('id') }} />
```

| 部分                                 | 説明                                            |
| ---------------------------------- | --------------------------------------------- |
| `class="form-control..."`          | Bootstrapなどの見た目を適用。エラー時に赤枠用クラス`is-invalid`を追加 |
| `$errors->has($session_key)`       | Laravelのバリデーションエラーを確認                         |
| `name="{{ $input_name }}"`         | PHPで作成した入力名を設定                                |
| `value="{{ old($session_key) }}"`  | エラー後でも前回の入力値を保持                               |
| `placeholder="{{ $placeholder }}"` | プレースホルダーテキストを設定                               |
| `min="0"`                          | 最小値を設定                                        |
| `{{ $attributes->except('id') }}`  | 呼び出し時に渡した追加属性（例：`required`など）を適用              |


---

## エラーメッセージ表示部分

```bash
<div class="invalid-feedback">
    {{ $errors->first($session_key) }}
</div>
```
- `$errors->first($session_key)` で、対象キーに紐づく 最初のエラーメッセージ を取得
- Bootstrapの .invalid-feedback クラスで下部に赤文字を表示

---

## まとめ

| 概念                  | 意味                      |
| ------------------- | ----------------------- |
| **コンポーネント**         | 再利用可能なテンプレート部品          |
| **props**           | コンポーネントに渡す外部パラメータ       |
| **@php**            | Blade内でPHPを使う           |
| **$errors / old()** | バリデーションとフォーム再表示のためのヘルパー |
| **$attributes**     | 呼び出し側で追加指定されたHTML属性     |
