# コンポーネント

➡️ 再利用性・責任分離・保守性などの目的

| 技術                      | コンポーネントの書き方           | 備考                                   |
| ------------------------- | -------------------------------- | -------------------------------------- |
| **React**                 | `<MyComponent prop="value" />`   | JSX構文でpropsを渡す                   |
| **Vue**                   | `<my-component :prop="value" />` | SFCやテンプレートで使える              |
| **Web Components (純JS)** | `<my-element></my-element>`      | `customElements.define()` で定義       |
| **Blade (Laravel)**       | `<x-my-component />`             | `resources/views/components` に定義    |
| **HTMLのみ**              | ❌                                | コンポーネント機能はなし               |
| **JavaScriptのみ**        | （関数やクラスで再現）          | UI部品を関数で生成するなどの工夫が必要 |


## propsとは
- 例：
```php
@props(['entity', 'name', 'middle' => null, 'placeholder' => '', 'session_key' => null])
```

**➡️ このコンポーネントが受け取る引数（プロパティ）を定義**

- entity: 主となるエンティティ名（例：'school_discount'）
- name: 入力要素の名前（例：'discount_rate'）
- middle: 配列の途中のキーを指定するための引数。簡単に言うと、「グループ化するための目印」。デフォルトはnull
- placeholder: 入力欄のプレースホルダーテキスト。デフォルトは空文字列
- session_key: エラーメッセージやoldヘルパーで使用するセッションキー。デフォルトはnullで、自動生成


```php
@php
    $input_name = $entity . ($middle !== null ? "[$middle]" : '') . "[$name]";
    $session_key = $session_key ?? $entity . ($middle !== null ? ".$middle" : '') . ".$name";
@endphp
```

php内は、変数の値を組み立てる作業をした場合
**➡️ @phpブロックは、Bladeテンプレート内でPHPコードを直接実行するためのもの**

- `$input_name = ...:` HTMLのname属性の値を動的に生成。entity、middle、nameを組み合わせて、school_discount`"school_discount[special_discount]"`のような形式をる
- `$session_key = ...:` バリデーションエラーや古い入力値を保持するために使用するセッションキーを生成。school_discount.plan.discount_rateのような形式になる。$session_keyがnullの場合にこの処理が実行される。


```php
<input type="number" class="form-control{{ $errors->has($session_key) ? ' is-invalid' : '' }}" name="{{ $input_name }}"
    placeholder="{{ $placeholder }}" value="{{ old($session_key) }}" min="0"
    @if ($attributes->has('id')) id="{{ $attributes->get('id') }}" @endif {{ $attributes->except('id') }} />
```

**➡️ 実際に描画されるHTMLの`<input>`要素**

- `class="form-control{{ $errors->has($session_key) ? ' is-invalid' : '' }}"`:
form-controlはBootstrapなどのCSSフレームワークで使われるクラス

- `$errors->has($session_key)`は、Laravelのバリデーションで指定されたセッションキーにエラーがあるかどうかをチェック。エラーがある場合は、`is-invalid`クラスを追加し、入力欄を赤枠で表示させる

- `name="{{ $input_name }}"`: 先ほどPHPで生成した$input_nameをname属性に設定

- `placeholder="{{ $placeholder }}"`: propsで受け取ったplaceholderをプレースホルダーとして設定

- `value="{{ old($session_key) }}"`: フォーム送信後にバリデーションエラーが発生した場合、oldヘルパーを使って、ユーザーが入力した古い値を再表示させる。これにより、ユーザーは再入力の手間を省ける

- `min="0"`: 入力できる最小値を0に設定

- `@if ($attributes->has('id')) ... @endif {{ $attributes->except('id') }}`:

- コンポーネントを呼び出す際に渡された追加のHTML属性を処理する部分

- もしid属性が渡された場合はそれを設定し、それ以外の属性（例：requiredやclassなど）は`{{ $attributes->except('id') }}`でまとめて適用される。これにより、コンポーネントの柔軟性が高まる


```php
<div class="invalid-feedback">
    {{ $errors->first($session_key) }}
</div>
```
**➡️ バリデーションエラーが発生した場合に、その入力欄の下に表示されるエラーメッセージ**

- `{{ $errors->first($session_key) }}:` `$errors`オブジェクトから、指定された`$session_key`に対応する最初のエラーメッセージを取得して表示



```php
<input type="number" class="form-control" name="school_discount[special_discount]" placeholder="" value="0" min="0">
```
**➡️ 実際の出力**